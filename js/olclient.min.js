function getParamByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",a=new RegExp(t),r=a.exec(window.location);return null==r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function showVehicleStations(e){for(var t=0;t<e.sts.length;t++)!function(){var a=e.sts[t],r=transitLayer._getTimeString(a.at),i=transitLayer._getTimeString(a.dt),n="<li";t==e.sts.length-1&&(n+=" class='last'"),n+="><span class='time'>",(a.at!=a.dt||a.ad!=a.dd)&&(n+="<span class='arrTime'>"+r+"</span>"+(0!=a.ad?" <span class='arrDelay'>+"+transitLayer._getDelayString(a.ad)+"</span>":"")+"<br/>"),n+="<span class='depTime'>"+i+"</span>"+(0!=a.dd?" <span class='depDelay'>+"+transitLayer._getDelayString(a.dd)+"</span>":"")+"</span>",n+="</li>";var s=$("<span class='stationname'>"+a.n+"</span>");n=$(n),n.append(s),s.click(function(){!function(){var e=new OpenLayers.LonLat(a.p[0],a.p[1]);map.panTo(e)}()}),$("#bar #lineVerlauf ul").append(n),n.hide(),window.setTimeout(function(){n.fadeTo(500,1)},15*t)}();$("#bar #lineVerlauf #lineVerlaufScroll").jScrollPane({animateScroll:!0}).data("jsp").scrollToPercentX(0),$(window).resize(function(){$("#bar #lineVerlauf #lineVerlaufScroll").data("jsp").reinitialise()})}function clearVehicleWay(){$("#bar #lineNumber").hide(),$("#bar #lineTo").html(""),$("#bar #lineDesc").html(""),$("#bar #lineTravelTimes").html(""),$("#bar #lineVerlauf ul").html(""),$("#bar #barLoading").show()}function getOpDate(e){return e.y+1900+"/"+e.m+"/"+e.d}function getOpString(e,t,a){var r="";switch(a){case 31:r=DAY_SPANS.mtillfr;break;case 64:r=DAY_SPANS.sundays;break;case 32:r=DAY_SPANS.saturdays;break;case 96:r=DAY_SPANS.weekends;break;case 127:r=DAY_SPANS.daily;break;default:for(var i=Number(a).toString(2),n=!1,s=0;7>s;s++)"1"==i.charAt(s)&&(n&&(r+=", "),n=!0,r+=DAY_MAP[s])}if(e.length>0){for(var l="",s=0;s<e.length;s++)l+=getOpDate(e[s]),s<e.length-1&&(l+=", ");r+=e.length>10?0==a?"irregularly":" ("+MISC.irrservice+")":0==a?l:". "+MISC.addserviceon+" "+l+"."}if(t.length>0){for(var c="",s=0;s<t.length;s++)c+=getOpDate(t[s]),s<t.length-1&&(c+=", ");r+=" (no service on "+c+")"}return r}TransitLayer.prototype._getPWidth=function(e){switch(z=this._curZoom,e){case 0:return 5;case 1:switch(z){case 5:return 9;case 4:return 7;case 3:return 5;case 2:return 4;case 1:return 3;case 0:return 3}case 2:switch(z){case 5:return 11;case 4:return 11;case 3:return 8;case 2:return 6;case 1:return 3.5;case 0:return 3}case 3:return 4;default:switch(z){case 5:return 7;case 4:return 5.5;case 3:return 4;case 2:return 3;case 1:return 3;case 0:return 2.5}}return 1};var DAY_MAP=new Array("monday","tuesday","wednesday","thursday","friday","saturday","sunday"),DAY_SPANS={mtillfr:"monday till friday",sundays:"sundays",saturdays:"saturdays",weekends:"weekends",daily:"daily"},MISC={irrservice:"irregular additional services",addserviceon:"Additional service on"};window.showVehicleWay=function(e){$("#bar #lineVerlauf ul").html(""),$("#bar #barLoading").hide(),$("#bar #lineNumber").show(),$("#bar #lineNumber").html(e.sn),e.c?$("#bar #lineNumber").css("background-color","#"+e.c):$("#bar #lineNumber").css("background-color",transitLayer.getStandardBgColor(e.t)),e.tc?$("#bar #lineNumber").css("color","#"+e.tc):$("#bar #lineNumber").css("color",transitLayer.getStandardTextColor(e.t)),$("#bar #lineTo").html(e.hs),$("#bar #lineDesc").html(e.ln);var t="<span class='vehType'>"+transitLayer.getVehicleTypeName(e.t)+"</span>";t+="Operating: ",t+=getOpString(e.tt.p,e.tt.n,e.tt.t),$("#bar #lineTravelTimes").html(t),$("#bar #lineVerlauf ul").html(""),$("#bar #lineVerlauf ul").css("width",70*e.sts.length+50+"px"),showVehicleStations(e)},$("#slowerbut").click(function(){transitLayer.setMultiplicator(transitLayer.getMultiplicator()<=1?transitLayer.getMultiplicator()-.1:transitLayer.getMultiplicator()<=10?transitLayer.getMultiplicator()-1:transitLayer.getMultiplicator()<=20?transitLayer.getMultiplicator()-5:transitLayer.getMultiplicator()-10),$("#speedoview").html(transitLayer.getMultiplicator()<1?transitLayer.getMultiplicator().toFixed(1)+"x":transitLayer.getMultiplicator().toFixed(0)+"x")}),$("#normalbut").click(function(){transitLayer.setMultiplicator(1),$("#speedoview").html(transitLayer.getMultiplicator()+"x")}),$("#fasterbut").click(function(){transitLayer.setMultiplicator(transitLayer.getMultiplicator()<1?transitLayer.getMultiplicator().valueOf()-0+.1:transitLayer.getMultiplicator()<10?transitLayer.getMultiplicator()+1:transitLayer.getMultiplicator()<20?transitLayer.getMultiplicator()+5:transitLayer.getMultiplicator()+10),$("#speedoview").html(transitLayer.getMultiplicator()<1?transitLayer.getMultiplicator().toFixed(1)+"x":transitLayer.getMultiplicator().toFixed(0)+"x")}),$("#currenttime").click(function(){transitLayer.setCurrentTime(),transitLayer.setMultiplicator(1),$("#speedoview").html("1x")}),$("#barclosebut").click(function(){$("#bar").animate({height:0},200,"swing",function(){clearVehicleWay()}),transitLayer.clearVehicleTraj(),transitLayer.unselectVehicle()});var map=new OpenLayers.Map("map",{extent:[42e4,3e4,9e5,35e4],maxExtent:[42e4,3e4,9e5,35e4],resolutions:[750,500,250,100,50,20]}),attribution="&copy; SBB/CFF/FFS",sbb_relief=new OpenLayers.Layer.WMTS({url:["http://map1.trafimage.ch/main/tilecache","http://map2.trafimage.ch/main/tilecache","http://map3.trafimage.ch/main/tilecache"],displayInLayerSwitcher:!1,requestEncoding:"REST",buffer:0,style:"default",dimensions:["TIME"],params:{time:"2012"},maxExtent:new OpenLayers.Bounds(42e4,3e4,9e5,35e4),resolutions:[750,500,250,100,50,20],matrixSet:"swissgrid_50",projection:new OpenLayers.Projection("EPSG:21781"),units:"m",formatSuffix:"png",ref:"netzkarte_relief",name:OpenLayers.i18n("netzkarte_relief"),attribution:attribution,mapserverLayers:"netzkarte_raster_relief",resolutions:[750,500,250,100,50,20],matrixSet:"swissgrid_20",layer:"netzkarte_raster_relief",formatSuffix:"jpeg",group:"background",visibility:!0,isBaseLayer:!0}),starttime=(new Date).getTime(),statMode=!1;if(getParamByName("statmode"))var statMode=getParamByName("statmode");if(getParamByName("lat")&&getParamByName("lon"))var pos=new L.LatLng(getParamByName("lat"),getParamByName("lon"));if(getParamByName("z"))var zoom=getParamByName("z");if(getParamByName("t"))var starttime=parseInt(getParamByName("t"));var epsg4326=new OpenLayers.Projection("EPSG:4326"),zurich=new OpenLayers.LonLat(653176.34,227279.43);map.addLayer(sbb_relief),map.setCenter(zurich,3);var transitLayer=new TransitLayer({time:starttime,statMode:!1});transitLayer._timeStepArray=new Array(3e3,2e3,500,300,200,200),transitLayer._standardTextColor=new Array("#000000","#000000","#000000","#000000","#f4f4f4","#000000","#000000","#000000");var trajClient=new TrajectoryClient("http://localhost:8989");transitLayer.setTrajectoryClient(trajClient),transitlayer=new OpenLayers.Layer.TransitLayer("transit",{transitLayer:transitLayer}),map.addLayer(transitlayer),transitLayer.addVehicleSelectListener(function(e){transitLayer.clearVehicleTraj(),clearVehicleWay(),$("#bar").animate({height:240},200,"swing",function(){trajClient.getTrajectoryStations(e,"window.showVehicleWay")}),transitLayer.showVehicleTraj(e)}),transitLayer.addTimeChangeListener(function(){var e=transitLayer.getCurTime();if($("#clock").html(pad(e.getHours(),2)+":"+pad(e.getMinutes(),2)+":"+pad(e.getSeconds(),2)),void 0!==transitLayer.getTimeZone()){var t=new Date(e.getTime()+1e3*transitLayer.getTimeZone().os);$("#localclock").html(pad(t.getUTCHours(),2)+":"+pad(t.getUTCMinutes(),2)+":"+pad(t.getUTCSeconds(),2)+" ("+transitLayer.getTimeZone().c+")")}else $("#localclock").html("-")}),$("#bar #lineNumber").hide();