function getParamByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\?&]"+e+"=([^&#]*)",t=new RegExp(a),r=t.exec(window.location);return null==r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function showVehicleStations(e){for(var a=0;a<e.sts.length;a++)!function(){var t=e.sts[a],r=transitLayer._getTimeString(t.at),n=transitLayer._getTimeString(t.dt),i="<li";a==e.sts.length-1&&(i+=" class='last'"),i+="><span class='time'>",(t.at!=t.dt||t.ad!=t.dd)&&(i+="<span class='arrTime'>"+r+"</span>"+(0!=t.ad?" <span class='arrDelay'>+"+transitLayer._getDelayString(t.ad)+"</span>":"")+"<br/>"),i+="<span class='depTime'>"+n+"</span>"+(0!=t.dd?" <span class='depDelay'>+"+transitLayer._getDelayString(t.dd)+"</span>":"")+"</span>",i+="</li>";var l=$("<span class='stationname'>"+t.n+"</span>");i=$(i),i.append(l),l.click(function(){!function(){map.panTo(new L.latLng(t.p[0],t.p[1]))}()}),$("#bar #lineVerlauf ul").append(i),i.hide(),window.setTimeout(function(){i.fadeTo(500,1)},15*a)}();$("#bar #lineVerlauf #lineVerlaufScroll").jScrollPane({animateScroll:!0}).data("jsp").scrollToPercentX(0),$(window).resize(function(){$("#bar #lineVerlauf #lineVerlaufScroll").data("jsp").reinitialise()})}function clearVehicleWay(){$("#bar #lineNumber").hide(),$("#bar #lineTo").html(""),$("#bar #lineDesc").html(""),$("#bar #lineTravelTimes").html(""),$("#bar #lineVerlauf ul").html(""),$("#bar #barLoading").show()}function getOpDate(e){return e.y+1900+"/"+e.m+"/"+e.d}function getOpString(e,a,t){var r="";switch(t){case 31:r=DAY_SPANS.mtillfr;break;case 64:r=DAY_SPANS.sundays;break;case 32:r=DAY_SPANS.saturdays;break;case 96:r=DAY_SPANS.weekends;break;case 127:r=DAY_SPANS.daily;break;default:for(var n=Number(t).toString(2),i=!1,l=0;7>l;l++)"1"==n.charAt(l)&&(i&&(r+=", "),i=!0,r+=DAY_MAP[l])}if(e.length>0){for(var s="",l=0;l<e.length;l++)s+=getOpDate(e[l]),l<e.length-1&&(s+=", ");r+=e.length>10?0==t?"irregularly":" ("+MISC.irrservice+")":0==t?s:". "+MISC.addserviceon+" "+s+"."}if(a.length>0){for(var o="",l=0;l<a.length;l++)o+=getOpDate(a[l]),l<a.length-1&&(o+=", ");r+=" (no service on "+o+")"}return r}var DAY_MAP=new Array("monday","tuesday","wednesday","thursday","friday","saturday","sunday"),DAY_SPANS={mtillfr:"monday till friday",sundays:"sundays",saturdays:"saturdays",weekends:"weekends",daily:"daily"},MISC={irrservice:"irregular additional services",addserviceon:"Additional service on"};window.showVehicleWay=function(e){$("#bar #lineVerlauf ul").html(""),$("#bar #barLoading").hide(),$("#bar #lineNumber").show(),$("#bar #lineNumber").html(e.sn),e.c?$("#bar #lineNumber").css("background-color","#"+e.c):$("#bar #lineNumber").css("background-color",transitLayer.getStandardBgColor(e.t)),e.tc?$("#bar #lineNumber").css("color","#"+e.tc):$("#bar #lineNumber").css("color",transitLayer.getStandardTextColor(e.t)),$("#bar #lineTo").html(e.hs),$("#bar #lineDesc").html(e.ln);var a="<span class='vehType'>"+transitLayer.getVehicleTypeName(e.t)+"</span>";a+="Operating: ",a+=getOpString(e.tt.p,e.tt.n,e.tt.t),$("#bar #lineTravelTimes").html(a),$("#bar #lineVerlauf ul").html(""),$("#bar #lineVerlauf ul").css("width",70*e.sts.length+50+"px"),showVehicleStations(e)},$("#slowerbut").click(function(){transitLayer.setMultiplicator(transitLayer.getMultiplicator()-.5),$("#speedoview").html(transitLayer.getMultiplicator()+"x")}),$("#normalbut").click(function(){transitLayer.setMultiplicator(1),$("#speedoview").html(transitLayer.getMultiplicator()+"x")}),$("#fasterbut").click(function(){transitLayer.setMultiplicator(transitLayer.getMultiplicator()+.5),$("#speedoview").html(transitLayer.getMultiplicator()+"x")}),$("#currenttime").click(function(){transitLayer.setCurrentTime(),transitLayer.setMultiplicator(1),$("#speedoview").html("1x")}),$("#barclosebut").click(function(){$("#bar").animate({height:0},200,"swing",function(){clearVehicleWay()}),transitLayer.clearVehicleTraj(),transitLayer.unselectVehicle()});var gmapLayer=new L.Google("HYBRID"),osmLayer=new L.TileLayer("http://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"",maxZoom:20}),oenvKarteLayer=new L.TileLayer("http://tile.memomaps.de/tilegen/{z}/{x}/{y}.png",{attribution:"",maxZoom:20}),starttime=(new Date).getTime(),pos=new L.LatLng(46.980252,8.26129),zoom=9,statMode=!1;if(getParamByName("statmode"))var statMode=getParamByName("statmode");if(getParamByName("lat")&&getParamByName("lon"))var pos=new L.LatLng(getParamByName("lat"),getParamByName("lon"));if(getParamByName("z"))var zoom=getParamByName("z");if(getParamByName("t"))var starttime=parseInt(getParamByName("t"));var transitLayer=new TransitLayer({time:starttime,statMode:statMode}),leafletTransitPlug=new T.Layer(transitLayer),trajClient=new TrajectoryClient("http://panarea.informatik.uni-freiburg.de/routeplanner/ts_requestforwarder.php");transitLayer.setTrajectoryClient(trajClient);var map=L.map("map").setView(pos,zoom);map.addLayer(osmLayer).addLayer(leafletTransitPlug);var baseMaps={OpenStreetMap:osmLayer,"Public Transit Map":oenvKarteLayer,"Google Maps":gmapLayer};L.control.layers(baseMaps).addTo(map),transitLayer.addVehicleSelectListener(function(e){transitLayer.clearVehicleTraj(),clearVehicleWay(),$("#bar").animate({height:240},200,"swing",function(){trajClient.getTrajectoryStations(e,"window.showVehicleWay")}),transitLayer.showVehicleTraj(e)}),transitLayer.addTimeChangeListener(function(){var e=transitLayer.getCurTime();if($("#clock").html(pad(e.getHours(),2)+":"+pad(e.getMinutes(),2)+":"+pad(e.getSeconds(),2)),void 0!==transitLayer.getTimeZone()){var a=new Date(e.getTime()+1e3*transitLayer.getTimeZone().os);$("#localclock").html(pad(a.getUTCHours(),2)+":"+pad(a.getUTCMinutes(),2)+":"+pad(a.getUTCSeconds(),2)+" ("+transitLayer.getTimeZone().c+")")}else $("#localclock").html("-")}),$("#bar #lineNumber").hide();